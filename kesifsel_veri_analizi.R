#Ke??ifsel Veri Analizi, RStudio Uygulama
#????renci: Meliksah Yavuz ARSLAN, meliksahyavuzarslan@gmail.com / meliksahyavuzarslan@anadolu.edu.tr

#T??m ??al????ma boyunca kullan??lacak paketler:
install.packages("MASS")
library(MASS)
install.packages("zoo")
library(zoo)
install.packages("corrplot")
library(corrplot)
install.packages("caTools")
library(caTools)

#Veri ??retimi, rastgele veri olu??turma y??ntemiyle yap??lacakt??r.
set.seed(555) #Ara??t??rmalarda tekrarlanabilirli??in sa??lan??m?? i??in seed belirlenir.

n <- 1000 # G??zlem say??s??n?? 1000 olarak belirliyorum.

x1 <- rnorm(n, mean = 4, sd = 1) # Ba????ms??z de??i??ken 1 
x2 <- rnorm(n, mean = 9, sd = 3) # Ba????ms??z de??i??ken 2
x3 <- rnorm(n, mean = 2, sd = 2) # Ba????ms??z de??i??ken 3
x4 <- rnorm(n, mean = 8, sd = 0.5) # Ba????ms??z de??i??ken 4
x5 <- rnorm(n, mean = 3, sd = 3) # Ba????ms??z de??i??ken 5
y <- (3 + 5*x1) - (1*x2) + (2*x3) + (4*x4) - (8*x5) + rnorm(n, mean = 0, sd = 3) # Ba????ml?? de??i??ken
#Ba????ml?? ve ba????ms??z de??i??kenleri olu??turuyorum. Standart sapma ve mean de??erlerini giriyorum.
#sd ve mean de??erleri ilerideki testlerde anlaml?? farkl??l??klar olu??turacakt??r.

#Veriyi olu??turduk ve ??imdi istedi??imiz gibi oldu??unu kontrol etmek i??in mean bakaca????m:
mean(x1) #mean'?? 4 alm????t??k yukar??da ama 3.94 ????kt??, bekledi??imiz gibi 4'e yak??n.

#??imdi veri setini data.frame'e ??eviriyoruz:
orijinal_data <- data.frame(y, x1, x2, x3, x4, x5)
head(orijinal_data) #ilk 6 de??eri g??rmek i??in head kodunu kullan??yorum ve i??eri??i inceliyorum.

-
  
#Veri kalitesi i??in eksik verinin tespiti ve eksik verinin tamamlanmas??:
#Bunun i??in "ChickWeight" verisini kullanaca????m:
data2=data.frame(ChickWeight)
is_na_ChickWeight <- is.na(data2)
is_na_ChickWeight #bu komut ile "is_na_ChickWeight"teki t??m verilerin FALSE kar????l??????n?? verdi??ini g??r??yorum. NA data yok.

#ChickWeight'teki weight, diyetlerle ili??kili olarak a????rl??klar??n?? g??stermektedir.
#Zamansal s??ralamaya g??re veriler oldu??u i??in ????yle bir varsay??mda bulunabilirim: 
#E??er bir Weight de??eri NA olsayd??, Time'a g??re s??ral?? oldu??u i??in, ??nceki ve sonraki weight de??erine g??re
#bir veri ekleme yapabilirim.

chick_weight_filled <- na.locf(ChickWeight)
#Medyana g??re eksik veriyi doldurmak veriyi daha da bozabilece??i i??in, dersimizde g??rd??????m??z 2. yolu tercih ettim.

#Veri Kalitesini incelemek i??in Ayk??r?? de??er tespitini yap??yorum:
set.seed(099)
data_aykiri = rnorm(300, mean= 3, sd= 4) #Mean'in 3 oldu??u, sd'nin 4 oldu??u bir data veri ??retiyorum.
mean(data_aykiri) #2.7 de??erini elde ediyoruz.

#ilk ??nce g??rsel ara??larla testimizi yapaca????m
boxplot(data_aykiri) #??retilen g??rsele bakt??????m??zda -10'a kayan birka?? g??zlemin oldu??unu g??r??yoruz.
sort(data_aykiri) #sd'nin b??y??kl?????? dolay??s??yla aral??ktan b??y??k bir??ok de??er sapt??yoruz.

#G??rsel y??ntemin yan?? s??ra Z-Puan?? hesaplayal??m:
z_scores_aykiri = scale(data_aykiri)
z_scores_aykiri

(data_aykiri[3]-mean(data_aykiri/sd(data_aykiri))) #??rnek tek bir de??er i??in z skoru hesaplama

aykiri_degerler <- abs(z_scores_aykiri) > 3 #bu komut ile de??erleri mutlak de??ere ??evirdik ve ??ayet sabit rakam 3'ten b??y??ksek TRUE yapt??rd??k.
aykiri_degerler #True de??erler yani aykirilar i??in testimizi yap??yoruz ve sonu??lar?? direkt kontrol ediyoruz.

#Alt ve ??st ??eyreklik de??erlerini analiz ediyoruz:
quantile1 = quantile(data_aykiri, 0.25) #-0.22 de??eri alt ??eyrekliktir
quantile2 = quantile(data_aykiri, 0.5) #2.82 de??eri medyand??r
quantile3 = quantile(data_aykiri, 0.75) #5.52 de??eri ??st ??eyrekli??idir

#??stteki hesaplardan alt ve ??st s??n??r?? hesaplayaca????z ve ard??ndan ayk??r?? de??erleri belirleyece??iz:
ust_alt_fark = quantile3 - quantile1

alt_sinir = quantile1 - 1.5 * ust_alt_fark
ust_sinir = quantile3 + 1.5 * ust_alt_fark
#??stteki iki ayr?? komut ile veriyi sa??a ve sola do??ru geni??letiyoruz ayk??r??lar?? tespit i??in
aykirilar_sonuc = data_aykiri < alt_sinir | data_aykiri > ust_sinir 
#b??ylece data_aykiri, aykirilar_sonuc'tan k??????kse alt_sinir'dan; b??y??kse ust_sinir'dan veri ??ek demek.
aykirilar_sonuc  #burada da ??ekilen veri b??y??kse TRUE verecektir yani onlar ayk??r?? olanlard??r diyebilece??iz.
#toplam 3 TRUE yani aykiri de??er var diyoruz.

#Da????l??mlar?? ke??if i??in ??rnek bir veri seti olu??turuyorum:

set.seed(929)
dagilim_kesif = rnorm(300, mean= 1.5, sd= 2)

# Histogram olu??turma ve g??z ile kontrol?? ger??ekle??tiriyorum
hist(dagilim_kesif) 

# Kutu grafi??i olu??turma
boxplot(dagilim_kesif)  # ??rnek verideki mean ve sd sebebiyle aykiri de??er al??nam??yor.

# Q-Q plot olu??turma
qqnorm(dagilim_kesif)
qqline(dagilim_kesif) 
#Q-Q plot ile ??izginin ??evresinde da????ld??????n?? g??r??yoruz verilerin.

# Korelasyon testi i??in veri seti olu??turma
set.seed(552)
x_2 <- rnorm(250) # Ba????ms??z de??i??ken
y_2 <- 2*x_2 + rnorm(250, mean = 1, sd = 3) # Ba????ml?? de??i??ken
korelasyon = cor(x_2, y_2)
print(korelasyon) #Korelasyon say??s?? 1'e yak??n olursa o derece bir uyu??ma oalcakt??. Fakat sd de??eri sebebiyle olduk??a d??????k ????kt??.

#Multicollinearity Testi
# ??rnek veri setini olu??turma
set.seed(999)
x4 <- rnorm(250) # Ba????ms??z de??i??ken 1
x5 <- rnorm(250) # Ba????ms??z de??i??ken 2
x6 <- rnorm(250) # Ba????ms??z de??i??ken 3
y2 <- 3*x4 + 6*x5 - 8*x6 + rnorm(250, mean = 3, sd = 1) # Ba????ml?? de??i??ken
#x4'in kat say??s?? 3, x5'nin 6, x6'n??n -8.

# ??oklu do??rusal regresyon modelini olu??turma
model_coklu <- lm(y2 ~ x4 + x5 + x6) #x4+x5+x6 ba????ms??z, y2 ise ba????ml??.

# Model ??zetini alma
options(scipen=999) #bilimsel say?? g??sterimini kapat??yorum modelin ??zetini daha rahat anlamak i??in
summary(model_coklu)
#Pr seviyeleri "??ok iyi", ortalama sapma miktar?? da olu??turdu??umuz verilerle zorunlu olarak birebir ili??kili.


# Ba????ms??z de??i??kenler aras??ndaki korelasyonu hesaplama
korelasyon_matrix <- cor(data.frame(x4, x5, x6))
print(korelasyon_matrix)
#birbirleriyle ili??kileri olduk??a d??????k, rastgele veriler olmas??ndan ??t??r??.

# Korelasyon matrisini g??rselle??tirme
corrplot(korelasyon_matrix, method = "color")


# Ba????ms??z de??i??kenlerin grafi??ini ??izme
par(mfrow=c(1,3)) 
plot(x4, y2, main = "x4 vs. y2", xlab = "x4", ylab = "y2", col = "black", pch = 16)
plot(x5, y2, main = "x5 vs. y2", xlab = "x5", ylab = "y2", col = "orange", pch = 16)
plot(x6, y2, main = "x6 vs. y2", xlab = "x6", ylab = "y2", col = "gray", pch = 16)

#Veriyi standartla??t??rma i??lemini yapal??m

set.seed(888)
x7 <- rnorm(250) # Ba????ms??z de??i??ken 1
x8 <- rnorm(250) # Ba????ms??z de??i??ken 2
x9 <- rnorm(250) # Ba????ms??z de??i??ken 3
y4 <- 2*x7 + 3*x8 - 1.5*x9 + rnorm(250, mean = 0, sd = 1) # Ba????ml?? de??i??ken

summary(x7)
# Veriyi standartla??t??rma

x7_standartlastirilmis <- scale(x7)
x8_standartlastirilmis <- scale(x8)
x9_standartlastirilmis <- scale(x9)
y4_standartlastirilmis <- scale(y4)

summary(x7_standartlastirilmis) #mean 0'land?? g??r??ld?????? ??zere, standartla??t??r??ld??.
summary(x8_standartlastirilmis)
summary(x9_standartlastirilmis)
summary(y4_standartlastirilmis)


#Test ve e??itim alt k??meleri i??in veri olu??turma ve di??er i??lemler
set.seed(666)
x10 <- rnorm(280) #Ba????ms??z de??i??ken 1
x11 <- rnorm(280) #Ba????ms??z de??i??ken 2
x12 <- rnorm(280) #Ba????ms??z de??i??ken 3
y10 <- 2*x10 + 1.5*x11 - 1.75*x12 + rnorm(280, mean = 0, sd = 0.75) # Ba????ml?? de??i??ken

# Verinin test ve e??itim alt k??melerine b??l??m??
split <- sample.split(y10, SplitRatio = 0.8) # 80% e??itim, 20% test
egitim_veri <- subset(data.frame(x10, x11, x12, y10), split == TRUE)
test_veri <- subset(data.frame(x10, x11, x12, y10), split == FALSE)

# Verinin boyutlar??n?? kontrol etme
dim(egitim_veri) # y??zdelik de??eri kar????layacak ??ekilde 224 ????kt??.
dim(test_veri) #y??zdelik de??eri kar????layacak ??ekilde 56 ????kt??.


